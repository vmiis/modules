<section>
    VmInclude:__BASE__/vmiis/Common-Code/grid/grid.html
</section>
<script>
    function F__ID(){
        //-------------------------------------
        VmInclude:__BASE__/vmiis/Common-Code/grid/grid.js
        VmInclude:__BASE__/vmiis/Common-Code/style/ease-in-out.js
        VmInclude:__CURRENT_PATH__/task.js
        //-------------------------------------
        _task_fields="Date,Time,Screening conducted by";
        _task_fields+=",How did you... find out about this study";
        _task_fields+=",Do you have... any difficulty with understanding or writing in English";
        _task_fields+=",Sleep clinician";
        _task_fields+=",Date of Polysomnogram";
        _task_fields+=",Indication for PSG";
        _task_fields+=",Next clinician... appointment";
        _task_fields+=",Screening ID";
        _task_fields+=",CRC ID";
        _task_fields+=",Full name";
        _task_fields+=",Date of birth";
        _task_fields+=",Sex";
        _task_fields+=",Age (Exclude if &lt; 18)|Age";
        _task_fields+=",MRN";
        _task_fields+=",Home Phone";
        _task_fields+=",Mobile";
        _task_fields+=",Email";
        _task_fields+=",Address";
        _task_fields+=",Do you have... difficulty sleeping at the moment";
        _task_fields+=",What is your... main sleep difficulty (Getting to sleep  staying asleep  waking up too early non-restorative sleep  daytime fatigue  daytime sleepiness)|What is your main sleep difficulty";
        _task_fields+=",How long have... you had a sleep problem";
        _task_fields+=",Have you previously... seen a physician about your sleep";
        _task_fields+=",Have you previously had a sleep study";
        _task_fields+=",If yes when";
        _task_fields+=",If yes what was the diagnosis";
        _task_fields+=",Have you ever... been prescribed treatment for your sleep (Specify if applicable - Exclude if prior CPAP/Mandibular advancement/or CBTi for a period of 3 months in the last 6 months)|Have you ever been prescribed treatment for your sleep";
        _task_fields+=",Are you currently... on treatment for a sleep disorder (Specify if applicable - Exclude if current use of CPAP/MAS/CBTi for 3 months in the last 6 months)|Are you currently on treatment for a sleep disorder";
        _task_fields+=",Do you work... overnight - Exclude if overnight work during core sleep hours (between 12am and 3am) in the last 6 months|Do you work overnight";
        _task_fields+=",Have you travelled... overseas in the past 2 months (more than 3 time zones East to West)|Have you travelled overseas in the past 2 months";
        _task_fields+=",Was that travel... to a different time zone - (exclude if &gt; 2 hours different) (if applicable)|Was that travel to a different time zone";
        _task_fields+=",Do you have... any physical health conditions for which you have recently received medical treatment (If yes specify)|Do you have any physical health conditions for which you have recently received medical treatment";
        _task_fields+=",Are you currently... pregnant or breastfeeding a child (If female)|Are you currently pregnant or breastfeeding a child";
        _task_fields+=",Have you ever had... a stroke or head injury (If yes record details and exclude if moderate/severe long term effects)|Have you ever had a stroke or head injury";
        _task_fields+=",Have you ever been... diagnosed with a mental health condition";
        _task_fields+=",What mental health... conditions do you have (if applicable)|What mental health conditions do you have";
        _task_fields+=",Do you smoke";
        _task_fields+=",If yes How many do you smoke a day";
        _task_fields+=",Are you currently... participating in any other research trials or have you recently participated in another clinical research study";
        _task_fields+=",If you are... not suitable for any of the studies ongoing at the moment are you happy for your details to be kept on a database so that you may be contacted in the future should a suitable study start";
        _fields="_Form,Status|S2,Notes|NT,Participant,"+_task_fields;
        _fields+=",Submit Date|DateTime,Submitted by|Author,_Delete,_Hidden|Participant_uid";
        //-------------------------------------
        $('#D__ID').on('load',function(){  _set_req(); _request_data(); })
        $('#D__ID').on('back',function(){  _set_req(); _request_data(); })
        //-------------------------------------
        _cell_render=function(records,I,field,td,set_value,source){
            _default_cell_render(records,I,field,td,set_value,source);
            switch(field){
                case 'Date':
                case 'Date_of_Polysomnogram':
                    records[I].vm_custom[field]=true;
                    td.html('<input style="border:0; width:80px" />')
                    td.find('input').val(records[I][field])
                    td.find('input').datepicker({dateFormat:'dd/mm/yy',changeMonth:true, changeYear:true,onClose:function(dateText) {
                        set_value(dateText,records,I,field);
                    }});
                    break;
                case 'Time':
                    records[I].vm_custom[field]=true;
                    td.html('<input style="border:0; width:100px" type=Time />')
                    td.find('input').val(records[I][field]);
                    td.find('input').on('input', function(){
                        set_value($(this).val(),records,I,field);
                    });
                    break;
                case 'Sex':
                    records[I].vm_custom[field]=true;
                    var html="<select style='border:0;''>"
                    html+="<option value=''>---</option>";
                    html+="<option>Male</option>";
                    html+="<option>Female</option>";
                    html+="</select>"
                    td.html(html)
                    td.find('select').val(records[I][field])
                    td.find('select').on('input', function(){
                        set_value($(this).val(),records,I,field);
                    });
                    break;
                case 'Do_you_have_difficulty_sleeping_at_the_moment':
                case 'Have_you_previously_had_a_sleep_study':
                case 'Do_you_smoke':
                case 'If you are not suitable for any of the studies ongoing at the moment are you happy for your details to be kept on a database so that you may be contacted in the future should a suitable study start':
                    records[I].vm_custom[field]=true;
                    var html="<select style='border:0;''>"
                    html+="<option value=''>---</option>";
                    html+="<option>Yes</option>";
                    html+="<option>No</option>";
                    html+="</select>"
                    td.html(html)
                    td.find('select').val(records[I][field])
                    td.find('select').on('input', function(){
                        set_value($(this).val(),records,I,field);
                    });
                    break;
            }
        }
        //-------------------------------------
        _before_submit=function(record,dbv){
            return _set_status_and_participant(record,dbv);
        }
        //-------------------------------------
        _widthA='40%'; _widthB='60%';
    }
</script>
<style>
    VmInclude:__BASE__/vmiis/Common-Code/grid/grid.css
    ul.ui-autocomplete.ui-menu{font-size:12px}
    .ui-autocomplete li:hover{
        color:White;
        background:#96B202;
        font-weight:normal;
        outline:none;
    }
</style>
