<div>
	<div id=toolbar__ID>
		<a id=back__ID>Back</a><span class=tab__ID></span><span id=nav_link__ID></span>
	</div>
	<div id=panel__ID style='clear:left;'>
		<div class='nav__ID'>
		    <span>Modules</span>
			<div id=modules__ID>
			</div>
		</div>
		<div class='nav__ID'>
		    <span>Queries</span>
			<div id=queries__ID>
			</div>
		</div>
	</div>
</div>
<script>
//---------------------------------------------
function F__ID(){
	//---------------------------------------------
	VmInclude:__BASE__/vmiis/Common-Code/navigation/navigation.js
	VmInclude:__BASE__/vmiis/Common-Code/style/ease-in-out.js
	//---------------------------------------------
	$('#D__ID').on('load',function(){
		var c=$vm.vm['__ID'].op.category;
		var s=$vm.vm['__ID'].op.subcategory;
		var n=c; if(s!='') n=c+' / '+s;
	    _nav_name=n;
	    _set_nav_link();
		request_data(c,s);
	});
	//---------------------------------------------
	var li_permission={};
	var set_li_permission=function($li,records){
		var i=$li.attr('data-i');
		var tid=records[i].Table_ID;
		var per=li_permission['P'+tid]
		if(tid==undefined || tid=='') per=1;
		if(per==undefined){
			//set_li_permission($(this),tid)
			$VmAPI.request({data:{cmd:'query_permission',db_pid:tid},callback:function(res){
				if(res.pms!=undefined){
					var p=parseInt(res.pms) & parseInt("1111",2); //read,write,delete,full
					if(p==0){
						li_permission['P'+tid]=0;
						$li.addClass('not_allowed__ID')
					}
					else{
						li_permission['P'+tid]=1;
						$li.removeClass('not_allowed__ID');
					}
				}
			}})
		}
		else if(per==1){
			$li.removeClass('not_allowed__ID');
		}
		else if(per==0){
			$li.addClass('not_allowed__ID')
		}
	}
	//---------------------------------------------------------------
	var module_records;
	var query_records;
	var request_data=function(category,subcategory){
		//---------------------------------------------
		var sql="select UID,Information from [TABLE-"+_module.var.module_tid+"] where S2=@S2 and S3=@S3 order by S1";
		$VmAPI.request({data:{cmd:'query_records',sql:sql,s1:'',s2:category,s3:subcategory},callback:function(res){
			module_records=res.records;
			var txt='<ul>'
			for(var i=0;i<res.records.length;i++){
				var nm=$('<div/>').html(res.records[i].Name).text();
				txt+='<li data-i='+i+'>'+nm+'</li>';
			}
			txt+='</ul>'
			$('#modules__ID').html(txt);
			//---------------------------------------------
			$('#modules__ID li').on('click',function(){
				var i=$(this).attr('data-i');
				load_module(i)
			});
			//---------------------------------------------
			$('#modules__ID li').each(function(){
				set_li_permission($(this),module_records)
			})
			//---------------------------------------------
		}})
		//---------------------------------------------
		var sql="select UID,Information from [TABLE-"+_module.var.query_tid+"] where S2=@S2 and S3=@S3 order by S1";
		$VmAPI.request({data:{cmd:'query_records',sql:sql,s1:'',s2:category,s3:subcategory},callback:function(res){
			query_records=res.records;
			var txt='<ul>'
			for(var i=0;i<res.records.length;i++){
				var nm=$('<div/>').html(res.records[i].Name).text();
				txt+='<li data-i='+i+'>'+nm+'</li>';
			}
			txt+='</ul>'
			$('#queries__ID').html(txt);
			//---------------------------------------------
			$('#queries__ID li').on('click',function(){
				var i=$(this).attr('data-i');
				load_query(i)
			});
			//---------------------------------------------
			$('#queries__ID li').each(function(){
				set_li_permission($(this),query_records)
			})
			//---------------------------------------------
		}})
		//---------------------------------------------
	}
	//---------------------------------------------
	var load_module=function(I){
		var url=module_records[I].URL;
		for(var i=0;i<$vm.trust_path.length;i++){
			var len=$vm.trust_path[i].length;
			if(url.indexOf($vm.trust_path[i])!==-1 && url.substring(0,len)==$vm.trust_path[i]){
				var v={}
				try{
					v=JSON.parse(module_records[I].Input);
				}catch (e) {}
				var module="M"+module_records[I].UID;
				if(window.location.hostname=='127.0.0.1' || window.location.hostname=='localhost'){
					url=url.replace('https://vmiis.github.io',window.location.protocol+'//'+window.location.host+'/vmiis');
					url=url.replace('https://rt.woolcock.org.au/github/woolcock-imr',window.location.protocol+'//'+window.location.host+'/woolcock-imr');
					url=url.replace('https://cbs.wappsystem.com/dev/github',window.location.protocol+'//'+window.location.host);
					url=url.replace('https://woolcock-imr.github.io',window.location.protocol+'//'+window.location.host+'/woolcock-imr');
				}
				$vm.module_list[module]={
					table_id:module_records[I].Table_ID,
					url:url,
					var:v,
				}
				$vm.load_module_by_name(module,$vm.root_layout_content_slot,{})
				return;
			}
		}
	}
	//---------------------------------------------
	var load_query=function(i){
		var query_form=_module.var.query_form;
		$vm.load_module_by_name(query_form,$vm.root_layout_content_slot,{
			sql:query_records[i]['SQL'],
			options:query_records[i]['Options'],
			name:query_records[i]['Name'],
			input_1:query_records[i].input_1,
			input_2:query_records[i].input_2,
			input_3:query_records[i].input_3,
			input_4:query_records[i].input_4,
			input_5:query_records[i].input_5,
		})
	}
	//---------------------------------------------
}
</script>
<style>
    VmInclude:__BASE__/vmiis/Common-Code/navigation/navigation.css
    #D__ID{
        background: url("__BASE__/vmiis/common-code/image/texture.png");
    }
    .nav__ID span{
        color:#005500;
    }
    .nav__ID li{
        padding-top:3px;
        padding-bottom:3px;
    }
    .nh__ID{
        color:#999!Important;
        font-size:8pt;
        font-weight: normal!Important;
        margin:0!Important;
    }
    @media screen and (max-width:900px){
        #D__ID{
            font-size:16pt;
        }
    }
</style>
