<div>
	<div id=toolbar__ID>
		<a id=back__ID>Back</a><span class=tab__ID></span><span id=nav_link__ID></span>
	</div>
	<div id=panel__ID style='clear:left;'>
	</div>
</div>
<script>
//---------------------------------------------
function F__ID(){
	//---------------------------------------------
	VmInclude:__LIB__/vmiis/Common-Code/navigation/navigation.js
	VmInclude:__LIB__/vmiis/Common-Code/style/ease-in-out.js
	//---------------------------------------------
	_sys.config.module_ids={}
	var panel_id='main_panel';
	var config=_sys.config;
	//---------------------------------------------
	_nav_name=config.panels['main_panel'].name;
	_set_nav_link();
	//---------------------------------------------
	//make unique id and add module to module list
	for(var P in config.panels){
		var UID=_mobj.op.record.UID;
		var aPanel=config.panels[P];
		var url=aPanel.url;
		for(i=0;i<aPanel.columns.length;i++){
			var aColumn=aPanel.columns[i];
			for(j=0;j<aColumn.sections.length;j++){
				var aSection=aColumn.sections[j];
				for(k=0;k<aSection.tasks.length;k++){
					var aTask=aSection.tasks[k];
					aTask.section_name=aSection.name;
					var m_id=aTask.module_id;
					var new_m_id='M_'+UID+'_'+P+'_'+m_id;
					aTask.module_id=new_m_id;
					$vm.module_list[new_m_id]=aTask;
					config.module_ids[m_id]=new_m_id;
					//---------------------
					//process form_module
					var fm=aTask.form_module;
					if(fm!=undefined){
						var new_fm='M_'+UID+'_'+P+'_'+fm;
						aTask.form_module=new_fm;
						$vm.module_list[new_fm]=aTask;
					}
					//---------------------
				}
			}
		}
	}
	//---------------------------------------------
	//pande render and add click event handler
	var txt="";
	var thePanel=config.panels[panel_id];
	for(i=0;i<thePanel.columns.length;i++){
		var aColumn=thePanel.columns[i];
		txt+="<div class=nav__ID>";
		for(j=0;j<aColumn.sections.length;j++){
			var aSection=aColumn.sections[j];
			var header=aSection.name;
			txt+="<span>"+$('<div/>').html(header).text()+"</span><ul>";
			for(k=0;k<aSection.tasks.length;k++){
				var aTask=aSection.tasks[k];
				var task=aTask.name;
				if(task!=undefined){
					var m_id=aTask.module_id;
					txt+="<li data-mid="+$('<div/>').html(m_id).text()+">"+$('<div/>').html(task).text()+"</li>";
				}
			}
			txt+="</ul>";
		}
		txt+="</div>";
	}
	$('#panel__ID').html(txt);
	$('#panel__ID li').on('click',function(){
		event.stopPropagation();
        if( $(this).hasClass( 'not_allowed__ID' )===true){
              alert("No permission!");
              return;
        }
		var mid=$(this).attr('data-mid');
		load_module(mid)
	});
	//---------------------------------------------
	//set permission
	$('#panel__ID li').each(function(){
		if($vm.server=='production'){
			$('.nav__ID li').each(function(index){
				$(this).addClass('not_allowed__ID')
				var m_id=$(this).attr('data-mid');
				if(m_id!==undefined && $vm.module_list[m_id]!==undefined){
					var pid=$vm.module_list[m_id].table_id;
					if(pid!==undefined && pid!=='--------' && pid!==''){
						set_li_permission($(this),pid);
					}
					else $(this).removeClass('not_allowed__ID');
				}
				else $(this).removeClass('not_allowed__ID');
			});
		}
	})
	//---------------------------------------------
	$('#D__ID').on('load',function(){
	});
	//---------------------------------------------
	var load_module=function(module_id){
		var url=$vm.module_list[module_id].url;
		var single_record=$vm.module_list[module_id].single_record;
		var trust=0;
		for(var i=0;i<$vm.trust_path.length;i++){
			var len=$vm.trust_path[i].length;
			if(url.indexOf($vm.trust_path[i])!==-1 && url.substring(0,len)==$vm.trust_path[i]){
				trust=1;
			}
		}
		if(trust==0){
			alert("The url ("+url+") is not trusted.")
			return;
		}
		//transfer parent module and record, because this is a panel module
		var this_mobj  =_mobj.op.mobj;
		var this_record=_mobj.op.record;
		var op={
			//-----------------
			sys:_sys,
			mobj:this_mobj,
			record:this_record,
			//-----------------
			single_record:single_record,
			panel:panel_id,
		}
		var slot=$vm.root_layout_content_slot;
		if(single_record=='1') slot=undefined;
		$vm.load_module_by_name(module_id,slot,op)
	};
	//---------------------------------------------
}
</script>
<style>
    VmInclude:__LIB__/vmiis/Common-Code/navigation/navigation.css
    #D__ID{
        background: url("__LIB__/vmiis/common-code/image/texture.png");
    }
    .nav__ID span{
		margin-top: 10px;
        color:#005500;
    }
    .nav__ID li{
        padding-top:1px;
        padding-bottom:1px;
    }
    .nh__ID{
        color:#999!Important;
        font-size:8pt;
        font-weight: normal!Important;
        margin:0!Important;
    }
    @media screen and (max-width:900px){
        #D__ID{
            font-size:16pt;
        }
		.nav__ID li{
	        padding-top:3px;
	        padding-bottom:3px;
	    }
    }
</style>
